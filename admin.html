<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Marqetly</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="admin-body">

<div class="admin-container">
    <h2>Admin Panel</h2>
    
    <div class="admin-sections">
        <div class="admin-card">
            <h3>Add Product</h3>
            <form id="addProductForm">
                <input type="text" id="productName" placeholder="Product Name" required>
                <input type="number" id="productPrice" placeholder="Price" step="0.01" required>
                <div class="image-upload-section">
                    <label>Product Images:</label>
                    <input type="file" id="productImages" multiple accept="image/*">
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                <button type="submit">Add Product</button>
            </form>
        </div>

        <div class="admin-card">
            <h3>Product List</h3>
            <div id="adminProducts"></div>
        </div>
    </div>

    <button onclick="logout()" class="logout-btn">Sign Out</button>
</div>

<script>
    function logout() {
        localStorage.removeItem('isAdmin');
        window.location.href = 'auth.html';
    }

    // Image preview
    document.getElementById('productImages').addEventListener('change', function(e) {
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = '';
        
        for(let file of e.target.files) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.width = '100px';
                img.style.height = '100px';
                img.style.objectFit = 'cover';
                img.style.margin = '5px';
                img.style.borderRadius = '5px';
                preview.appendChild(img);
            }
            reader.readAsDataURL(file);
        }
    });

    // Add product function
    document.getElementById('addProductForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('productName').value;
        const price = document.getElementById('productPrice').value;
        
        // Save images as base64
        const files = document.getElementById('productImages').files;
        
        if(files.length === 0) {
            alert('Please add at least one image!');
            return;
        }

        // Use first image for demo
        const reader = new FileReader();
        reader.onload = function(e) {
            const product = {
                id: Date.now(),
                name: name,
                price: parseFloat(price),
                image: e.target.result,
                images: [e.target.result]
            };
            
            let products = JSON.parse(localStorage.getItem('products')) || [];
            products.push(product);
            localStorage.setItem('products', JSON.stringify(products));
            
            loadAdminProducts();
            this.reset();
            document.getElementById('imagePreview').innerHTML = '';
            loadProducts();
        }
        reader.readAsDataURL(files[0]);
    });

    function loadAdminProducts() {
        const products = JSON.parse(localStorage.getItem('products')) || [];
        const container = document.getElementById('adminProducts');
        container.innerHTML = '';
        
        products.forEach((product, index) => {
            container.innerHTML += `
                <div class="admin-product-item">
                    <img src="${product.image}" alt="${product.name}" width="50">
                    <span>${product.name} - $${product.price}</span>
                    <button onclick="deleteProduct(${index})">Delete</button>
                </div>
            `;
        });
    }

    function deleteProduct(index) {
        let products = JSON.parse(localStorage.getItem('products')) || [];
        products.splice(index, 1);
        localStorage.setItem('products', JSON.stringify(products));
        loadAdminProducts();
        loadProducts();
    }

    function loadProducts() {
        const products = JSON.parse(localStorage.getItem('products')) || [];
        
        const container = document.getElementById('productGrid');
        if(container) {
            container.innerHTML = '';
            
            products.forEach(product => {
                container.innerHTML += `
                    <div class="product-card" onclick="viewProduct(${product.id})">
                        <img src="${product.image}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>$${product.price}</p>
                        <button class="buy-now">Buy Now</button>
                    </div>
                `;
            });
        }
    }

    function viewProduct(productId) {
        localStorage.setItem('currentProductId', productId);
        window.location.href = 'product-detail.html';
    }

    // Page load
    window.onload = function() {
        loadAdminProducts();
        loadProducts();
    };
</script>

</body>
</html>
